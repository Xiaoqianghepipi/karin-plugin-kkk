import amagi, { bilibiliAPI, getBilibiliData, wbi_sign } from '@ikenxuan/amagi';
import { Config } from '../../module/index.js';
import { genParams } from '../../platform/bilibili/index.js';
export async function fetchBilibiliData(type, opt) {
    const cl = new amagi({ bilibili: Config.cookies.bilibili });
    switch (type) {
        case 'one_video': {
            const INFODATA = await cl.getBilibiliData('单个视频作品数据', {
                id_type: 'bvid',
                id: opt.id
            });
            const DATA = await cl.getBilibiliData('单个视频下载信息数据', {
                avid: INFODATA.data.aid,
                cid: INFODATA.data.cid
            });
            const BASEURL = bilibiliAPI.视频流信息({ avid: INFODATA.data.aid, cid: INFODATA.data.cid });
            const SIGN = await genParams(BASEURL);
            const COMMENTSDATA = await cl.getBilibiliData('评论数据', {
                number: Config.bilibili.numcomment,
                type: 1,
                oid: INFODATA.data.aid
            });
            const EMOJIDATA = await cl.getBilibiliData('Emoji数据');
            return { INFODATA, DATA, COMMENTSDATA, EMOJIDATA, USER: SIGN, TYPE: 'one_video' };
        }
        case 'nock_video': {
            const dt = await getBilibiliData('单个视频下载信息数据', '', {
                avid: opt.avid,
                cid: opt.cid
            });
        }
        case 'work_comments': {
            const INFODATA = await cl.getBilibiliData('单个视频作品数据', {
                id_type: 'bvid',
                id: opt.id
            });
            const aCOMMENTSDATA = await cl.getBilibiliData('评论数据', {
                number: Config.bilibili.numcomment,
                type: 1,
                oid: INFODATA.data.aid
            });
            return aCOMMENTSDATA;
        }
        case 'emoji_list':
            return await cl.getBilibiliData('Emoji数据');
        case 'new_login_qrcode':
            return await cl.getBilibiliData('申请二维码', Config.cookies.bilibili);
        case 'check_qrcode': {
            return await cl.getBilibiliData('二维码状态', { qrcode_key: opt.qrcode_key });
        }
        case 'bangumi_video_info': {
            let cleanedId = '', isep = false;
            if (opt.ep_id) {
                cleanedId = opt.ep_id.replace('ep', '');
                isep = true;
            }
            else if (opt.season_id) {
                cleanedId = opt.season_id.replace('ss', '');
                isep = false;
            }
            const INFO = await cl.getBilibiliData('番剧基本信息数据', { ...opt });
            const QUERY = await genParams(isep ? bilibiliAPI.番剧明细({ id: cleanedId, isep }) : bilibiliAPI.番剧明细({ id: cleanedId, isep }));
            return { INFODATA: INFO, USER: QUERY, TYPE: 'bangumi_video_info' };
        }
        case 'user_dynamic': {
            const result = await cl.getBilibiliData('用户主页动态列表数据', { host_mid: opt.host_mid });
            return result;
        }
        case 'dynamic_info': {
            const dynamicINFO = await cl.getBilibiliData('动态详情数据', { dynamic_id: opt.dynamic_id });
            const dynamicINFO_CARD = await cl.getBilibiliData('动态卡片数据', { dynamic_id: dynamicINFO.data.item.id_str });
            const PARAM = await wbi_sign(bilibiliAPI.评论区明细({ type: 1, oid: dynamicINFO_CARD.data.card.desc.rid, number: Config.bilibili.numcomment }), Config.cookies.bilibili);
            const COMMENTSDATA = await cl.getBilibiliData('评论数据', { type: mapping_table(dynamicINFO.data.item.type), oid: oid(dynamicINFO, dynamicINFO_CARD), number: Config.bilibili.numcomment });
            const EMOJIDATA = await cl.getBilibiliData('Emoji数据');
            const USERDATA = await cl.getBilibiliData('用户主页数据', { host_mid: dynamicINFO.data.item.modules.module_author.mid });
            return { dynamicINFO, dynamicINFO_CARD, COMMENTSDATA, EMOJIDATA, USERDATA, TYPE: 'dynamic_info' };
        }
        case 'user_profile': {
            const result = await cl.getBilibiliData('用户主页数据', { host_mid: opt.host_mid });
            return result;
        }
        case 'dynamic_info': {
            const result = await cl.getBilibiliData('动态详情数据', { dynamic_id: opt.dynamic_id });
            return result;
        }
        case 'dynamic_card': {
            const result = await cl.getBilibiliData('动态卡片数据', { dynamic_id: opt.dynamic_id });
            return result;
        }
        case 'live_room_detail': {
            const live_info = await cl.getBilibiliData('直播间信息', { room_id: opt.room_id });
            const room_init_info = await cl.getBilibiliData('直播间初始化信息', { room_id: opt.room_id });
            const USERDATA = await cl.getBilibiliData('用户主页数据', { host_mid: room_init_info.data.uid });
            return { TYPE: type, live_info, room_init_info, USERDATA };
        }
        default:
            break;
    }
    return { TYPE: 'undefined' };
}
function mapping_table(type) {
    const Array = {
        1: ['DYNAMIC_TYPE_AV', 'DYNAMIC_TYPE_PGC', 'DYNAMIC_TYPE_UGC_SEASON'],
        11: ['DYNAMIC_TYPE_DRAW'],
        12: ['DYNAMIC_TYPE_ARTICLE'],
        17: ['DYNAMIC_TYPE_LIVE_RCMD', 'DYNAMIC_TYPE_FORWARD', 'DYNAMIC_TYPE_WORD', 'DYNAMIC_TYPE_COMMON_SQUARE'],
        19: ['DYNAMIC_TYPE_MEDIALIST']
    };
    for (const key in Array) {
        if (Array[key].includes(type)) {
            return parseInt(key, 10);
        }
    }
    return 1;
}
function oid(dynamicINFO, dynamicINFO_CARD) {
    if (dynamicINFO.data.item.type === 'DYNAMIC_TYPE_WORD') {
        return dynamicINFO.data.item.id_str;
    }
    else
        return dynamicINFO_CARD.data.card.desc.rid;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2V0RGF0YS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9wbGF0Zm9ybS9iaWxpYmlsaS9nZXREYXRhLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sS0FBSyxFQUFFLEVBQUUsV0FBVyxFQUFFLGVBQWUsRUFBRSxRQUFRLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQTtBQUUvRSxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sVUFBVSxDQUFBO0FBQ2pDLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQTtBQUcvQyxNQUFNLENBQUMsS0FBSyxVQUFVLGlCQUFpQixDQUNyQyxJQUFPLEVBQ1AsR0FBUztJQUVULE1BQU0sRUFBRSxHQUFHLElBQUksS0FBSyxDQUFDLEVBQUUsUUFBUSxFQUFFLE1BQU0sQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQTtJQUMzRCxRQUFRLElBQUksRUFBRSxDQUFDO1FBQ2IsS0FBSyxXQUFXLENBQUMsQ0FBQyxDQUFDO1lBQ2pCLE1BQU0sUUFBUSxHQUFHLE1BQU0sRUFBRSxDQUFDLGVBQWUsQ0FBQyxVQUFVLEVBQUU7Z0JBQ3BELE9BQU8sRUFBRSxNQUFNO2dCQUNmLEVBQUUsRUFBRSxHQUFHLENBQUMsRUFBRTthQUNYLENBQUMsQ0FBQTtZQUNGLE1BQU0sSUFBSSxHQUFHLE1BQU0sRUFBRSxDQUFDLGVBQWUsQ0FBQyxZQUFZLEVBQUU7Z0JBQ2xELElBQUksRUFBRSxRQUFRLENBQUMsSUFBSSxDQUFDLEdBQUc7Z0JBQ3ZCLEdBQUcsRUFBRSxRQUFRLENBQUMsSUFBSSxDQUFDLEdBQUc7YUFDdkIsQ0FBQyxDQUFBO1lBQ0YsTUFBTSxPQUFPLEdBQUcsV0FBVyxDQUFDLEtBQUssQ0FBQyxFQUFFLElBQUksRUFBRSxRQUFRLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsUUFBUSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFBO1lB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