import amagi, { bilibiliAPI, getBilibiliData } from '@ikenxuan/amagi';
import { Config } from '../../module/index.js';
import { genParams } from '../../platform/bilibili/index.js';
export async function fetchBilibiliData(type, opt) {
    const cl = new amagi({ bilibili: Config.cookies.bilibili });
    switch (type) {
        case 'one_video': {
            const INFODATA = await cl.getBilibiliData('单个视频作品数据', {
                id_type: 'bvid',
                id: opt.id
            });
            const DATA = await cl.getBilibiliData('单个视频下载信息数据', {
                avid: INFODATA.data.aid,
                cid: INFODATA.data.cid
            });
            const BASEURL = bilibiliAPI.视频流信息({ avid: INFODATA.data.aid, cid: INFODATA.data.cid });
            const SIGN = await genParams(BASEURL);
            const COMMENTSDATA = await cl.getBilibiliData('评论数据', {
                number: Config.bilibili.numcomment,
                type: 1,
                oid: INFODATA.data.aid
            });
            const EMOJIDATA = await cl.getBilibiliData('Emoji数据');
            return { INFODATA, DATA, COMMENTSDATA, EMOJIDATA, USER: SIGN, TYPE: 'one_video' };
        }
        case 'nock_video': {
            const dt = await getBilibiliData('单个视频下载信息数据', '', {
                avid: opt.avid,
                cid: opt.cid
            });
            return dt;
        }
        case 'work_comments': {
            const INFODATA = await cl.getBilibiliData('单个视频作品数据', {
                id_type: 'bvid',
                id: opt.id
            });
            const aCOMMENTSDATA = await cl.getBilibiliData('评论数据', {
                number: Config.bilibili.numcomment,
                type: 1,
                oid: INFODATA.data.aid
            });
            return aCOMMENTSDATA;
        }
        case 'emoji_list':
            return await cl.getBilibiliData('Emoji数据');
        case 'new_login_qrcode':
            return await cl.getBilibiliData('申请二维码', Config.cookies.bilibili);
        case 'check_qrcode': {
            return await cl.getBilibiliData('二维码状态', { qrcode_key: opt.qrcode_key });
        }
        case 'bangumi_video_info': {
            let cleanedId = '', isep = false;
            if (opt.ep_id) {
                cleanedId = opt.ep_id.replace('ep', '');
                isep = true;
            }
            else if (opt.season_id) {
                cleanedId = opt.season_id.replace('ss', '');
                isep = false;
            }
            const INFO = await cl.getBilibiliData('番剧基本信息数据', { ...opt });
            const QUERY = await genParams(isep ? bilibiliAPI.番剧明细({ id: cleanedId, isep }) : bilibiliAPI.番剧明细({ id: cleanedId, isep }));
            return { INFODATA: INFO, USER: QUERY, TYPE: 'bangumi_video_info' };
        }
        case 'user_dynamic': {
            const result = await cl.getBilibiliData('用户主页动态列表数据', { host_mid: opt.host_mid });
            return result;
        }
        case 'dynamic_info': {
            const dynamicINFO = await cl.getBilibiliData('动态详情数据', { dynamic_id: opt.dynamic_id });
            const dynamicINFO_CARD = await cl.getBilibiliData('动态卡片数据', { dynamic_id: dynamicINFO.data.item.id_str });
            const COMMENTSDATA = await cl.getBilibiliData('评论数据', { type: mapping_table(dynamicINFO.data.item.type), oid: oid(dynamicINFO, dynamicINFO_CARD), number: Config.bilibili.numcomment });
            const EMOJIDATA = await cl.getBilibiliData('Emoji数据');
            const USERDATA = await cl.getBilibiliData('用户主页数据', { host_mid: dynamicINFO.data.item.modules.module_author.mid });
            return { dynamicINFO, dynamicINFO_CARD, COMMENTSDATA, EMOJIDATA, USERDATA, TYPE: 'dynamic_info' };
        }
        case 'user_profile': {
            const result = await cl.getBilibiliData('用户主页数据', { host_mid: opt.host_mid });
            return result;
        }
        case 'dynamic_card': {
            const result = await cl.getBilibiliData('动态卡片数据', { dynamic_id: opt.dynamic_id });
            return result;
        }
        case 'live_room_detail': {
            const live_info = await cl.getBilibiliData('直播间信息', { room_id: opt.room_id });
            const room_init_info = await cl.getBilibiliData('直播间初始化信息', { room_id: opt.room_id });
            const USERDATA = await cl.getBilibiliData('用户主页数据', { host_mid: room_init_info.data.uid });
            return { TYPE: type, live_info, room_init_info, USERDATA };
        }
        default:
            break;
    }
    return { TYPE: 'undefined' };
}
function mapping_table(type) {
    const Array = {
        1: ['DYNAMIC_TYPE_AV', 'DYNAMIC_TYPE_PGC', 'DYNAMIC_TYPE_UGC_SEASON'],
        11: ['DYNAMIC_TYPE_DRAW'],
        12: ['DYNAMIC_TYPE_ARTICLE'],
        17: ['DYNAMIC_TYPE_LIVE_RCMD', 'DYNAMIC_TYPE_FORWARD', 'DYNAMIC_TYPE_WORD', 'DYNAMIC_TYPE_COMMON_SQUARE'],
        19: ['DYNAMIC_TYPE_MEDIALIST']
    };
    for (const key in Array) {
        if (Array[key].includes(type)) {
            return parseInt(key, 10);
        }
    }
    return 1;
}
function oid(dynamicINFO, dynamicINFO_CARD) {
    if (dynamicINFO.data.item.type === 'DYNAMIC_TYPE_WORD') {
        return dynamicINFO.data.item.id_str;
    }
    else
        return dynamicINFO_CARD.data.card.desc.rid;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2V0RGF0YS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9wbGF0Zm9ybS9iaWxpYmlsaS9nZXREYXRhLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sS0FBSyxFQUFFLEVBQUUsV0FBVyxFQUFFLGVBQWUsRUFBWSxNQUFNLGlCQUFpQixDQUFBO0FBRS9FLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxVQUFVLENBQUE7QUFDakMsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLHFCQUFxQixDQUFBO0FBRy9DLE1BQU0sQ0FBQyxLQUFLLFVBQVUsaUJBQWlCLENBQ3JDLElBQU8sRUFDUCxHQUFTO0lBRVQsTUFBTSxFQUFFLEdBQUcsSUFBSSxLQUFLLENBQUMsRUFBRSxRQUFRLEVBQUUsTUFBTSxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFBO0lBQzNELFFBQVEsSUFBSSxFQUFFLENBQUM7UUFDYixLQUFLLFdBQVcsQ0FBQyxDQUFDLENBQUM7WUFDakIsTUFBTSxRQUFRLEdBQUcsTUFBTSxFQUFFLENBQUMsZUFBZSxDQUFDLFVBQVUsRUFBRTtnQkFDcEQsT0FBTyxFQUFFLE1BQU07Z0JBQ2YsRUFBRSxFQUFFLEdBQUcsQ0FBQyxFQUFFO2FBQ1gsQ0FBQyxDQUFBO1lBQ0YsTUFBTSxJQUFJLEdBQUcsTUFBTSxFQUFFLENBQUMsZUFBZSxDQUFDLFlBQVksRUFBRTtnQkFDbEQsSUFBSSxFQUFFLFFBQVEsQ0FBQyxJQUFJLENBQUMsR0FBRztnQkFDdkIsR0FBRyxFQUFFLFFBQVEsQ0FBQyxJQUFJLENBQUMsR0FBRzthQUN2QixDQUFDLENBQUE7WUFDRixNQUFNLE9BQU8sR0FBRyxXQUFXLENBQUMsS0FBSyxDQUFDLEVBQUUsSUFBSSxFQUFFLFFBQVEsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxRQUFRLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUE7WUFDdEYsTUFBTSxJ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